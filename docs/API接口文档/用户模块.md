# 用户模块 (User)

## 2.1 获取用户公开资料

**接口**: `GET /users/:userId`  
**说明**: 获取指定用户的公开资料  
**需要认证**: 否

### URL 参数

```
userId: 用户 ID
```

### 响应示例

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "id": 123,
    "username": "goabroad_xiaoxin",
    "nickname": "GoAbroad小新",
    "avatarUrl": "https://cdn.goabroad.com/avatars/123.jpg",
    "bio": "正在准备美国留学",
    "gender": "MALE",
    "birthDate": "1995-06-15",
    "location": "北京",
    "postCount": 25,
    "followerCount": 120,
    "followingCount": 85,
    "status": "ACTIVE",
    "isFollowing": false,
    "createdAt": "2024-01-01T10:00:00"
  }
}
```

**🔧 [已修正 - 重要]**: 
- id改为数字类型
- avatar改为avatarUrl（与数据库avatar_url一致）
- 移除 level, badges（数据库users表无这些字段）
- 移除 stats 对象，直接使用 postCount, followerCount, followingCount（与数据库字段一致）
- 添加 birthDate, location（数据库users表有这些字段）
- 时间格式统一去掉Z后缀

---

## 2.2 更新用户资料

**接口**: `PUT /users/profile`  
**说明**: 更新当前用户的资料  
**需要认证**: 是

### 请求参数

```json
{
  "nickname": "新昵称",
  "bio": "个人简介",
  "gender": "MALE",
  "birthDate": "1995-06-15",
  "location": "北京"
}
```

**🔧 [已修正]**: 
- 所有字段与数据库users表一致
- 移除targetCountry、targetType、targetDate、currentStatus（这些字段属于user_preferences表，应使用单独的接口更新）

### 响应示例

```json
{
  "code": 200,
  "message": "资料更新成功",
  "data": {
    "id": 123,
    "username": "zhangsan",
    "nickname": "新昵称",
    "bio": "个人简介",
    "gender": "MALE",
    "birthDate": "1995-06-15",
    "location": "北京",
    "status": "ACTIVE",
    "updatedAt": "2024-10-25T10:30:00"
  }
}
```

**🔧 [已修正]**: 
- id改为数字类型
- 添加 birthDate, location（与数据库字段一致）
- 移除user_preferences相关字段

---

## 2.3 上传头像

**接口**: `POST /users/avatar`  
**说明**: 上传用户头像  
**需要认证**: 是  
**Content-Type**: `multipart/form-data`

### 请求参数

```
avatar: File（图片文件）
```

### 响应示例

```json
{
  "code": 200,
  "message": "头像上传成功",
  "data": {
    "avatarUrl": "https://cdn.goabroad.com/avatars/123.jpg",
    "thumbnailUrl": "https://cdn.goabroad.com/avatars/123_thumb.jpg"
  }
}
```

**🔧 [已修正]**: avatar改为avatarUrl，thumbnail改为thumbnailUrl（与数据库命名一致）

---

## 2.4 获取用户发布的帖子

**接口**: `GET /users/:userId/posts`  
**说明**: 获取指定用户发布的帖子列表  
**需要认证**: 否

### URL 参数

```
userId: 用户 ID
```

### Query 参数

```
page: 页码，默认 1
pageSize: 每页数量，默认 20
type: 帖子类型 (all, POST, QUESTION, TIMELINE)
```

### 响应示例

```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "items": [
      {
        "id": 123,
        "title": "美国F1签证面签经验分享",
        "summary": "今天刚刚通过面签...",
        "coverImage": "https://cdn.goabroad.com/posts/cover-123.jpg",
        "contentType": "POST",
        "tags": ["美国", "签证", "F1"],
        "likeCount": 125,
        "commentCount": 32,
        "collectCount": 85,
        "viewCount": 1520,
        "isLiked": false,
        "isCollected": false,
        "createdAt": "2024-10-20T10:00:00"
      }
    ],
    "pagination": {
      "currentPage": 1,
      "pageSize": 20,
      "totalItems": 25,
      "totalPages": 2,
      "hasNext": true,
      "hasPrevious": false,
      "isFirstPage": true,
      "isLastPage": false
    }
  }
}
```

**🔧 [已修正]**: 
- id改为数字类型
- content改为summary（列表显示摘要）
- type改为contentType（与数据库content_type一致）
- pagination结构改为统一格式（与文档开头定义一致）
- 移除时间Z后缀

---

## 2.5 获取用户收藏的帖子

**接口**: `GET /users/favorites`  
**说明**: 获取当前用户收藏的帖子  
**需要认证**: 是

### Query 参数

```
page: 页码
pageSize: 每页数量
```

---

## 2.6 关注用户

**接口**: `POST /users/:userId/follow`  
**说明**: 关注指定用户  
**需要认证**: 是

### 响应示例

```json
{
  "code": 200,
  "message": "关注成功",
  "data": {
    "isFollowing": true,
    "followersCount": 121
  }
}
```

---

## 2.7 取消关注用户

**接口**: `DELETE /users/:userId/follow`  
**说明**: 取消关注指定用户  
**需要认证**: 是

---

## 2.8 获取关注列表

**接口**: `GET /users/:userId/following`  
**说明**: 获取用户的关注列表  
**需要认证**: 否

### Query 参数

```
page: 页码
pageSize: 每页数量
```

---

## 2.9 获取粉丝列表

**接口**: `GET /users/:userId/followers`  
**说明**: 获取用户的粉丝列表  
**需要认证**: 否

---

## 数据模型

### 用户公开信息 (UserPublicVo)

```typescript
interface UserPublicVo {
  id: number;
  username: string;
  nickname: string;
  avatarUrl?: string;
  bio?: string;
  gender?: 'MALE' | 'FEMALE' | 'OTHER' | 'PREFER_NOT_TO_SAY';
  birthDate?: string;
  location?: string;
  postCount: number;
  followerCount: number;
  followingCount: number;
  status: 'ACTIVE' | 'INACTIVE' | 'BANNED' | 'DELETED';
  isFollowing: boolean;
  createdAt: string;
}
```

**说明**: 与数据库users表字段完全一致，移除了level、badges等不存在的字段

### 用户完整信息 (UserVo)

```typescript
interface UserVo {
  id: number;
  username: string;
  email?: string;
  phone?: string;
  nickname: string;
  avatarUrl?: string;
  bio?: string;
  gender?: 'MALE' | 'FEMALE' | 'OTHER' | 'PREFER_NOT_TO_SAY';
  birthDate?: string;
  location?: string;
  postCount: number;
  followerCount: number;
  followingCount: number;
  status: 'ACTIVE' | 'INACTIVE' | 'BANNED' | 'DELETED';
  emailVerified: boolean;
  phoneVerified: boolean;
  lastLoginAt?: string;
  lastLoginIp?: string;
  createdAt: string;
  updatedAt: string;
}
```

**说明**: 与数据库users表字段完全一致，移除了level、points、exp、isVip、vipExpireAt等不存在的字段

---

## 错误码说明

### 用户相关错误码 (40xxx)

| 错误码 | 说明 |
|--------|------|
| 40001 | 用户不存在 |
| 40002 | 用户已存在 |
| 40003 | 密码错误 |
| 40004 | 用户已被禁用 |
| 40005 | 用户名或密码错误 |

---

**文档版本**: v0.1.0  
**最后更新**: 2024-10-29

